<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Processing of Lung Computed Tomography (CT) Scans • lungct</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Processing of Lung Computed Tomography (CT) Scans">
<meta property="og:description" content="Processes and registers scans of lungs of computed
        tomography (CT) scans.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">lungct</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/muschellij2/lungct/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="lungct" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#lungct" class="anchor"></a>lungct</h1></div>

<p>The lungct R package develops an image processing pipeline for computed tomography (CT) scans of the lungs.</p>
<p><img src="inst/extdata/logo.png" alt="lungct logo"></p>
<p><img src="inst/extdata/pipeline.png" alt="Image Processing Pipeline"></p>
<div id="highlights" class="section level2">
<h2 class="hasAnchor">
<a href="#highlights" class="anchor"></a>Highlights</h2>
<ul>
<li><p>We develop a free and simple segmentation algorithm that is comparable to the proprietary VIDA Diagnostics software</p></li>
<li><p>We create the first publicly available standard lung template using healthy adults, which is available for download via lungct</p></li>
<li><p>We show that the standard lung template allows for improved population-level inference of lung CTs using radiomics</p></li>
<li><p>lungct provides a fully-automated and open-source image processing pipeline for lung CTs, which is accessible to statisticians</p></li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install lungct from github with:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"muschellij2/lungct"</span>)</pre></div>
</div>
<div id="segmentation" class="section level2">
<h2 class="hasAnchor">
<a href="#segmentation" class="anchor"></a>Segmentation</h2>
<p>To segment the lungs from the CT scan:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lungct</span>)
<span class="no">filename</span> <span class="kw">&lt;-</span> <span class="st">"example.nii.gz"</span>
<span class="no">mask</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lungct/man/segment_lung.html">segment_lung</a></span>(<span class="no">filename</span>)</pre></div>
<p>To segment the left and right lungs from the CT scan:</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">img</span> <span class="kw">&lt;-</span> <span class="kw pkg">ANTsRCore</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ANTsRCore/man/antsImageRead.html">antsImageRead</a></span>(<span class="no">filename</span>)
<span class="no">mask2</span> <span class="kw">&lt;-</span> <span class="fu">segment_lung2</span>(<span class="no">img</span>)</pre></div>
</div>
<div id="standard-lung" class="section level2">
<h2 class="hasAnchor">
<a href="#standard-lung" class="anchor"></a>Standard Lung</h2>
<p>The standard lung was created from N=62 healthy controls from <a href="http://www.copdgene.org/">COPDGene</a> (50% female, 95% white, mean age = 62 years, mean BMI = 28.5)</p>
<p>To load the standard lung:</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="co"># Read in standard lung template</span>
<span class="no">filepath</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(
    <span class="st">"extdata"</span>, <span class="st">"lung_template_mask.nii.gz"</span>,
    <span class="kw">package</span> <span class="kw">=</span> <span class="st">"lungct"</span>)
<span class="no">template</span> <span class="kw">&lt;-</span> <span class="kw pkg">ANTsRCore</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ANTsRCore/man/antsImageRead.html">antsImageRead</a></span>(<span class="no">filepath</span>)</pre></div>
</div>
<div id="registration" class="section level2">
<h2 class="hasAnchor">
<a href="#registration" class="anchor"></a>Registration</h2>
<p>To register the mask to the standard lung:</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="co"># Register mask to standard lung</span>
<span class="no">reg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lungct/man/register_lung_mask.html">register_lung_mask</a></span>(
    <span class="kw">moving_mask</span> <span class="kw">=</span> <span class="no">mask</span>,
    <span class="kw">fixed_mask</span> <span class="kw">=</span> <span class="no">template</span>,
    <span class="kw">moving</span> <span class="kw">=</span> <span class="no">img</span>,
    <span class="kw">sides</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"right"</span>,<span class="st">"left"</span>),
    <span class="kw">typeofTransform</span> <span class="kw">=</span> <span class="st">"SyN"</span>)</pre></div>
<p>We recommend the following for lung registration:</p>
<ul>
<li><p>Separately register the right and left lungs to account for differences in lung shape and size</p></li>
<li><p>Perform registration on lung masks to preserve biological variability in Hounsfield units (HU)</p></li>
<li><p>Use <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2276735/">Symmetric Normalization (SyN)</a> for nonlinear registration due to its flexibility and success in the <a href="https://empire10.grand-challenge.org/">EMPIRE10</a> challenge</p></li>
</ul>
</div>
<div id="template-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#template-creation" class="anchor"></a>Template Creation</h2>
<p>For template creation, we follow the iterative method from <a href="https://www.ncbi.nlm.nih.gov/pubmed/19818860">Avants</a>, using iterations of register_lung_mask, get_template, and calculate_DSC from lungct. However, we define convergence as having a Dice similarity coefficient (DSC) between successive iterations of at least 0.99. We recommend using parallelization for the registration step.</p>
<p><img src="inst/extdata/templatecreation.png" alt="Template Creation"></p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="co"># Obtain new template</span>
<span class="no">template_new</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lungct/man/get_template.html">get_template</a></span>(
    <span class="kw">folder_warp</span> <span class="kw">=</span> <span class="no">warped_masks</span>,
    <span class="kw">folder_comp</span> <span class="kw">=</span> <span class="no">transformations</span>)

<span class="co"># Check convergence     </span>
<span class="no">dice</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lungct/man/calculate_DSC.html">calculate_DSC</a></span>(<span class="no">template_init</span>, <span class="no">template_new</span>)</pre></div>
</div>
<div id="radiomics" class="section level2">
<h2 class="hasAnchor">
<a href="#radiomics" class="anchor"></a>Radiomics</h2>
<p>Radiomics, a field of quantitative imaging where large amounts of features are extracted from medical images, is common for lung CTs.</p>
<p>Options in lungct:</p>
<ul>
<li><p>radiomics_slice: Calculation on 2D slices in axial, coronal, or sagittal planes</p></li>
<li><p>radiomics_lung: Calculation on 3D right and left lungs</p></li>
<li><p>RIA_lung: Calculation of advanced radiomic features, such as GLCM and GLRLM <a href="https://github.com/cran/RIA">More info</a></p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="r"><span class="co"># Calculate radiomics</span>
<span class="no">rad</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lungct/man/RIA_lung.html">RIA_lung</a></span>(
    <span class="no">img</span>, <span class="no">mask</span>,
    <span class="kw">sides</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"right"</span>, <span class="st">"left"</span>),
    <span class="kw">features</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fo"</span>, <span class="st">"glcm"</span>),
    <span class="kw">bins_in</span> <span class="kw">=</span> <span class="fl">16</span>, <span class="kw">equal_prob</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">distance</span> <span class="kw">=</span> <span class="fl">1</span>,
    <span class="kw">statistic</span> <span class="kw">=</span> <span class="st">"mean(X, na.rm = TRUE)"</span>)</pre></div>
</div>
<div id="copdgene-data-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#copdgene-data-usage" class="anchor"></a>COPDGene data usage</h2>
<p>For the lung CT template, the <a href="http://www.copdgene.org/">COPDGene data</a> was used:</p>
<p>âThis research used data generated by the COPDGene study, which was supported by NIH grants U01HL089856 and U01HL089897. The COPDGene project is also supported by the COPD Foundation through contributions made by an Industry Advisory Board comprised of Pfizer, AstraZeneca, Boehringer Ingelheim, Novartis, and Sunovion.â</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/muschellij2/lungct/">https://​github.com/​muschellij2/​lungct/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/muschellij2/lungct/issues">https://​github.com/​muschellij2/​lungct/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>John Muschelli <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-6469-1750" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Brian Vestal <br><small class="roles"> Author </small>  </li>
<li>Sarah Ryan <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/muschellij2/lungct"><img src="https://travis-ci.org/muschellij2/lungct.svg?branch=master" alt="Travis-CI Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by John Muschelli, Brian Vestal, Sarah Ryan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
